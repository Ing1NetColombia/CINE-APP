<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ingreso Peliculas</title>
    <link rel="stylesheet" href="../../css/bootstrap.min.css" />
    <link rel="stylesheet" href="../../css/estilos.css" />
  </head>
  <body>
    <div class="container fondoblanco">
      <div class="dropdown">
        <button
          class="btn btn-secondary dropdown-toggle"
          type="button"
          id="dropdownMenu2"
          data-bs-toggle="dropdown"
          aria-expanded="false"
        >
          Configuración
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu2">
          <li>
            <a class="dropdown-item" href="/assets/Menu/peliculas/pelicula.html"
              >Peliculas</a
            >
          </li>
          <li>
            <a class="dropdown-item" href="/assets/Menu/confites/confites.html"
              >Confiteria</a
            >
          </li>
          <li>
            <a class="dropdown-item" href="/assets/Menu/horarios/horario.html"
              >Horarios y Tarifas</a
            >
          </li>
          <li><a class="dropdown-item" href="/index.html">Salir</a></li>
        </ul>
      </div>

      <div class="row">
        <div class="col-6 offset-3 justify-content-center">
          <h1>Ingreso de Peliculas</h1>

          <form action="" id="frmpelicula">
            <label for="id">Id </label>
            <input type="number" name="id" id="id" class="form-control" min="0" />

            <label for="nombre">Nombre</label>
            <input type="text" name="nombre" id="nombre" class="form-control" />

            <label for="sinopsis">Sinopsis</label>
            <textarea class="form-control" name="sinopsis" id="sinopsis" cols="30" rows="5"></textarea>

            <label for="categoria">Categoria</label>
            <select name="categoria" id="categoria" class="form-control">
              <option value="Comedia">Comedia</option>
              <option value="Suspenso">Suspenso</option>
              <option value="Caricatura">Caricatura</option>
              <option value="Ficcion">Ficción</option>
            </select>

            <label for="clasificacion"> Clasificación</label>
            <select name="clasificacion" id="clasificacion" class="form-control">
              <option value="7+">7+</option>
              <option value="15+">15+</option>
              <option value="18+">18+</option>
              <option value="Todos">Todos</option>
            </select>

            <label for="idtarifa">Tarifa</label>
            <select name="idtarifa" id="idtarifa" class="form-control">
              <option value="1"></option> <!--para traerlo de la tabla tarifas el campo orden-->
            </select>

            <input type="file" id="imagen" accept="image/*">  <!--  image/* me muestra el directorio  -->
           
            <div class="col-2 offset-5 my-5">
              <input
                type="button"
                class="btn btn-success"
                onclick="guardarPeliculas()"
                value="Guardar"
              />
            </div>

          </form>
        </div>
        <div class="col-2"></div>
        <div class="col-5">
          <table class="table table-striped table-hover">
            <thead class="justify-content-center">
              <th>Id</th>
              <th>Nombre</th>
              <th>Sinopsis</th>
              <th>Categoria</th>
              <th>Clasificacion</th>
              <th>Tarifa</th>
            </thead>
            <tbody id="tbl_pelicula"></tbody>
          </table>
        </div>
        <br />
      </div>
    </div>

    <div class="container fondoblanco">
      <footer>
        <div class="mt-3">
          <hr />
        </div>
        <div class="m-1 d-flex justify-content-center"></div>
        <div class="m-1">
          <p class="d-flex justify-content-center m-1">
            Copyright© 2023 todos los derechos reservados
          </p>
          <p class="d-flex justify-content-center">Cine Films ® SAS.</p>
          <hr />
        </div>
      </footer>
    </div>

    <script src="../../js/bootstrap.bundle.min.js"></script>

    <script>
      leerPelicula();

      function guardarPeliculas() {

        guardarImagen(objId);
      
        var peliculas = JSON.parse(localStorage.getItem("peliculag")) || []; //Obtiene los horarios ya guardados, si no sobreescribe en el localstorage

        var objId = document.getElementById("id").value;
        var objNombre = document.getElementById("nombre").value;
        var objSinopsis = document.getElementById("sinopsis").value;
        var objCategoria = document.getElementById("categoria").value;
        var objclasificacion = document.getElementById("clasificacion").value;
        var objidtarifa = document.getElementById("idtarifa").value;
       
        

        var pelicula = {
          id: objId,
          nombre: objNombre,
          sinopsis: objSinopsis,
          categoria: objCategoria,
          clasificacion: objclasificacion,
          tarifa: objidtarifa,
          imagen: localStorage.getItem("tmpimagen"),
        };

        localStorage.removeItem("tmpimagen");

        peliculas.push(pelicula); //envie lo que esta en el objeto pelicula

        localStorage.setItem("peliculag", JSON.stringify(peliculas)); //envia al localstorage

        leerPelicula();

        document.getElementById("frmpelicula").reset(); //limpiar formularios despues de grabar
      }

      function leerPelicula() {
        var peliculas = JSON.parse(localStorage.getItem("peliculag")) || [];

        var tbl_pelicula2 = document.getElementById("tbl_pelicula");

        tbl_pelicula2.innerHTML = ""; //hay que limpiar la tabla por que el foreach carga todos los horarios guardados en memoria
        peliculas.forEach(function (pelicular) {
          //comillas invertidas para poder utilizar etiquetas html dentro de js
          var cadena = ` 
            <tr>
                <td>${pelicular["id"]}</td>
                <td>${pelicular["nombre"]}</td>
                <td>${pelicular["sinopsis"]}</td>
                <td>${pelicular["categoria"]}</td>
                <td>${pelicular["clasificacion"]}</td>
                <td>${pelicular["tarifa"]}
            </tr>
            `;
          tbl_pelicula2.innerHTML += cadena;
        });
      }

      function guardarImagen (id) {
        var imgpelicula = document.getElementById("imagen");
        if(imgpelicula.files.length > 0){
          //console.log(imgpelicula.files);
          var n = imgpelicula.files[0];
          

          const a = new FileReader(); //file viene con metodos vacios
          a.onload = function(even){ // onload establecer que se va a hacer luego de convertir a base 64 - SOBREESCRIBIR UN METODO
            //console.log(b64imagen); //metodo de consola es para pruebas y mirar como vamos en consola, Cuando onload se utiliza con readasdataurl se sobre escribe sobre target.result
            localStorage.setItem("tmpimagen",even.target.result);
         }
          a.readAsDataURL(n);//metodo que convierte la imagen a base 64.
        }        
        

      }


    </script>




  </body>
</html>
